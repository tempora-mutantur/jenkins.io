<!DOCTYPE html>
<html lang="en">
<head>
<title>
Using Docker with Pipeline
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="description">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sites/default/files/jenkins_favicon.ico" rel="shortcut icon" type="image/x-icon">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/img/favicon.ico" rel="icon" sizes="32x32" type="img/png">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/img/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/img/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/img/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/img/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/img/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152">
<meta content="Using Docker with Pipeline" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="Using Docker with Pipeline" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/images/logo-title-opengraph.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="Using Docker with Pipeline" property="og:title">
<meta content="article" property="og:type">
<meta content="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/book/pipeline/docker/index.html" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="og:description">
<meta content="Using Docker with Pipeline" property="og:site_name">
<meta content="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/images/logo-title-opengraph.png" name="og:image">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/assets/bower/tether/css/tether.min.css" media="screen" rel="stylesheet">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/css/font-icons.css" media="screen" rel="stylesheet">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/css/jenkins.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/assets/bower/ionicons/css/ionicons.min.css" media="screen" rel="stylesheet">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/css/footer.css" media="screen" rel="stylesheet">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/css/font-awesome.min.css" media="screen" rel="stylesheet">
</head>
<body>
<script src="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<nav class="navbar navbar-expand-md navbar-dark top bg-dark fixed-top" id="ji-toolbar">
<a class="navbar-brand" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test">
Jenkins
</a>
<button class="navbar-toggler" data-target="#CollapsingNavbar" data-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="CollapsingNavbar">
<ul class="nav navbar-nav ml-auto">
<li class="nav-item">
<a class="nav-link" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/node">
Blog
</a>
</li>
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
Documentation
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc">
Use Jenkins
</a>
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/developer">
Extend Jenkins
</a>
<span class="dropdown-item">
<strong>
Use-cases
</strong>
</span>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/android">
&nbsp;-&nbsp;Android
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/c">
&nbsp;-&nbsp;C/C++
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/docker">
&nbsp;-&nbsp;Docker
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/embedded">
&nbsp;-&nbsp;Embedded
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/github">
&nbsp;-&nbsp;GitHub
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/java">
&nbsp;-&nbsp;Java
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/php">
&nbsp;-&nbsp;PHP
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/pipeline">
&nbsp;-&nbsp;Continuous Delivery
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/python">
&nbsp;-&nbsp;Python
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/ruby">
&nbsp;-&nbsp;Ruby
</a>
</div>
</li>
<li class="nav-item">
<a class="nav-link" href="https://plugins.jenkins.io/">
Plugins
</a>
</li>
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
Community
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/participate">
Overview
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/chat" title="Chat with the rest of the Jenkins community on IRC">
Chat
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/jam">
Meet
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/events">
Events
</a>
<a class="dropdown-item feature" href="https://issues.jenkins-ci.org/">
Issue Tracker
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/mailing-lists" title="Browse Jenkins mailing list archives and/or subscribe to lists">
Mailing Lists
</a>
<a class="dropdown-item feature" href="https://wiki.jenkins.io/">
Wiki
</a>
<a class="dropdown-item feature" href="https://accounts.jenkins.io/" title="Create/manage your account for accessing wiki, issue tracker, etc">
Account Management
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/">
<strong>
Special Interest Groups
</strong>
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/advocacy-and-outreach/">
&nbsp;-&nbsp;Advocacy and Outreach
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/chinese-localization/">
&nbsp;-&nbsp;Chinese Localization
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/cloud-native/">
&nbsp;-&nbsp;Cloud Native
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/docs/">
&nbsp;-&nbsp;Documentation
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/gsoc/">
&nbsp;-&nbsp;Google Summer of Code
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/hw-and-eda/">
&nbsp;-&nbsp;Hardware and EDA
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/pipeline-authoring/">
&nbsp;-&nbsp;Pipeline Authoring
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/platform/">
&nbsp;-&nbsp;Platform
</a>
</div>
</li>
<li class="dropdown nav-item">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
Subprojects
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/">
Overview
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/blueocean/">
Blue Ocean
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/evergreen/">
Evergreen
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/gsoc/">
Google Summer of Code in Jenkins
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/infrastructure/">
Infrastructure
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/jam/">
Jenkins Area Meetups
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/jcasc/">
Jenkins Configuration as Code
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/remoting/">
Jenkins Remoting
</a>
</div>
</li>
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
About
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/security">
Security
</a>
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/press">
Press
</a>
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/awards">
Awards
</a>
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/project/conduct">
Conduct
</a>
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/artwork">
Artwork
</a>
</div>
</li>
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
English
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/zh">
中文 Chinese
</a>
</div>
</li>
<li class="nav-item">
<a class="nav-link btn btn-outline-secondary" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/download">
Download
</a>
</li>
</ul>
</div>
</nav>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<script>
  $(function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.container .row .col-lg-9 h' + i);
    }
  })
</script>
<div class="container">
<div class="row body">
<div class="col-lg-3">
<div class="sidebar-nav tour">
<p>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc" class="">Jenkins User Documentation Home</a>
</p>
<h4>
Guided Tour
</h4>
<ul>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/pipeline/tour/getting-started" class="">Getting started</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/pipeline/tour/hello-world" class="">Creating your first Pipeline</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/pipeline/tour/running-multiple-steps" class="">Running multiple steps</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/pipeline/tour/agents" class="">Defining execution environments</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/pipeline/tour/environment" class="">Using environment variables</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/pipeline/tour/tests-and-artifacts" class="">Recording test results and artifacts</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/pipeline/tour/post" class="">Cleaning up and notifications</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/pipeline/tour/deployment" class="">Deployment</a>
</li>
</ul>
<h4>
Tutorials
</h4>
<ul>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/tutorials" class="">Overview</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/tutorials/build-a-java-app-with-maven" class="">Build a Java app with Maven</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/tutorials/build-a-node-js-and-react-app-with-npm" class="">Build a Node.js and React app with npm</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/tutorials/build-a-python-app-with-pyinstaller" class="">Build a Python app with PyInstaller</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/tutorials/create-a-pipeline-in-blue-ocean" class="">Create a Pipeline in Blue Ocean</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/tutorials/build-a-multibranch-pipeline-project" class="">End-to-End Multibranch Pipeline Project Creation</a>
</li>
</ul>
<ul>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/book/getting-started" class="">User Handbook overview</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/book/installing" class="">Installing Jenkins</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/book/using" class="">Using Jenkins</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/book/pipeline" class="active">Pipeline</a>
<small>
<ul style="padding-left: 1rem;">
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/book/pipeline/getting-started" class="">Getting started with Pipeline</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/book/pipeline/jenkinsfile" class="">Using a Jenkinsfile</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/book/pipeline/running-pipelines" class="">Running Pipelines</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/book/pipeline/multibranch" class="">Branches and Pull Requests</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/book/pipeline/docker" class="active">Using Docker with Pipeline</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/book/pipeline/shared-libraries" class="">Extending with Shared Libraries</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/book/pipeline/development" class="">Pipeline Development Tools</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/book/pipeline/syntax" class="">Pipeline Syntax</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/book/pipeline/scaling-pipeline" class="">Scaling Pipelines</a>
</li>
</ul>
</small>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/book/blueocean" class="">Blue Ocean</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/book/managing" class="">Managing Jenkins</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/book/system-administration" class="">System Administration</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/book/scaling" class="">Scaling Jenkins</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/book/appendix" class="">Appendix</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/book/glossary" class="">Glossary</a>
</li>
</ul>
<h4>
Resources
</h4>
<ul>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/book/pipeline/syntax" class="">Pipeline Syntax reference</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/pipeline/steps" class="">Pipeline Steps reference</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/upgrade-guide" class="">LTS Upgrade Guide</a>
</li>
</ul>
<h5>
Recent Tutorial Blog Posts
</h5>
<ul>
<li>
<a href="/blog/2017/11/27/tutorials-in-the-jenkins-user-documentation/">
Introducing Tutorials in the Jenkins User Documentation
</a>
</li>
<li>
<a href="/blog/2017/05/18/pipeline-dev-tools/">
Pipeline Development Tools
</a>
</li>
<li>
<a href="/blog/2017/04/12/welcome-to-blue-ocean-dashboard/">
Getting Started with the Blue Ocean Dashboard
</a>
</li>
</ul>
<div class="small">
<a href="/node/tags/tutorial">
View all tutorial blog posts
</a>
</div>
<p></p>
</div>
</div>
<div class="col-lg-9">
<div class="container">
<div class="row">
<div class="col-md-4">
<div class="row">
<a class="prev doc-page-link" href="../multibranch">
⇐ Branches and Pull Requests
</a>
</div>
</div>
<div class="col-md-4">
<div class="row">
<a class="up doc-page-link" href="../">
⇑ Pipeline
</a>
</div>
<div class="row">
<a class="index doc-page-link" href="../../">
Index
</a>
</div>
</div>
<div class="col-md-4">
<div class="row">
<a class="next doc-page-link" href="../shared-libraries">
Extending with Shared Libraries ⇒
</a>
</div>
</div>
</div>
</div>
<div class="container">
<div class="row body">
<div class="section">
<h1>
Using Docker with Pipeline
</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#execution-environment">Customizing the execution environment</a>
<ul class="sectlevel2">
<li><a href="#caching-data-for-containers">Caching data for containers</a></li>
<li><a href="#using-multiple-containers">Using multiple containers</a></li>
<li><a href="#dockerfile">Using a Dockerfile</a></li>
<li><a href="#specifying-a-docker-label">Specifying a Docker Label</a></li>
</ul>
</li>
<li><a href="#advanced-usage-with-scripted-pipeline">Advanced Usage with Scripted Pipeline</a>
<ul class="sectlevel2">
<li><a href="#running-sidecar-containers">Running "sidecar" containers</a></li>
<li><a href="#building-containers">Building containers</a></li>
<li><a href="#using-a-remote-docker-server">Using a remote Docker server</a></li>
<li><a href="#custom-registry">Using a custom registry</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Many organizations use <a href="https://www.docker.com">Docker</a> to unify their build
and test environments across machines, and to provide an efficient mechanism
for deploying applications. Starting with Pipeline versions 2.5 and higher,
Pipeline has built-in support for interacting with Docker from within a
<code>Jenkinsfile</code>.</p>
</div>
<div class="paragraph">
<p>While this section will cover the basics of utilizing Docker from with a
<code>Jenkinsfile</code>, it will not cover the fundamentals of Docker, which can be read
about in the
<a href="https://docs.docker.com/get-started/">Docker Getting Started Guide</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="execution-environment"><a class="anchor" href="#execution-environment"></a>Customizing the execution environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pipeline is designed to easily use
<a href="https://docs.docker.com/">Docker</a>
images as the execution environment for a single
<a href="../../glossary/#stage">Stage</a>
or the entire Pipeline. Meaning that a user can define the tools required for
their Pipeline, without having to manually configure agents.
Practically any tool which can be
<a href="https://hub.docker.com">packaged in a Docker container</a>.
can be used with ease by making only minor edits to a <code>Jenkinsfile</code>.</p>
</div>
<div class="pipeline-block">  <div class="listingblock pipeline-declarative">
    <div class="title">Jenkinsfile (Declarative Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">pipeline {
    agent {
        docker { image <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">node:7-alpine</span><span style="color:#710">'</span></span> }
    }
    stages {
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Test</span><span style="color:#710">'</span></span>) {
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">node --version</span><span style="color:#710">'</span></span>
            }
        }
    }
}</code></pre>
</div></div>  <div class="pipeline-script-expand">
    <a href="#" onclick="javascript:$(this).parent().siblings('.pipeline-script').toggle(); return false;">Toggle Scripted Pipeline</a>
    <em>(Advanced)</em>
  </div>
  <div class="listingblock pipeline-script"
        style="display: none">
    <div class="title">Jenkinsfile (Scripted Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">node {
    <span style="color:#777">/* Requires the Docker Pipeline plugin to be installed */</span>
    docker.image(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">node:7-alpine</span><span style="color:#710">'</span></span>).inside {
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Test</span><span style="color:#710">'</span></span>) {
            sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">node --version</span><span style="color:#710">'</span></span>
        }
    }
}</code></pre>
</div></div></div>
<div class="paragraph">
<p>When the Pipeline executes, Jenkins will automatically start the specified
container and execute the defined steps within it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[Pipeline] stage
[Pipeline] { (Test)
[Pipeline] sh
[guided-tour] Running shell script
+ node --version
v7.4.0
[Pipeline] }
[Pipeline] // stage
[Pipeline] }</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="caching-data-for-containers"><a class="anchor" href="#caching-data-for-containers"></a>Caching data for containers</h3>
<div class="paragraph">
<p>Many build tools will download external dependencies and cache them locally for
future re-use. Since containers are initially created with "clean" file
systems, this can result in slower Pipelines, as they may not take advantage of
on-disk caches between subsequent Pipeline runs.</p>
</div>
<div class="paragraph">
<p>Pipeline supports adding custom arguments which are passed
to Docker, allowing users to specify custom
<a href="https://docs.docker.com/engine/tutorials/dockervolumes/">Docker Volumes</a>
to mount, which can be used for caching data on the
<a href="../../glossary/#agent">agent</a>
between Pipeline runs. The following example will cache <code>~/.m2</code> between
Pipeline runs utilizing the
<a href="https://hub.docker.com/_/maven/"><code>maven</code> container</a>,
 thereby avoiding the need to re-download dependencies for subsequent runs of
 the Pipeline.</p>
</div>
<div class="pipeline-block">  <div class="listingblock pipeline-declarative">
    <div class="title">Jenkinsfile (Declarative Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">pipeline {
    agent {
        docker {
            image <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">maven:3-alpine</span><span style="color:#710">'</span></span>
            args <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">-v $HOME/.m2:/root/.m2</span><span style="color:#710">'</span></span>
        }
    }
    stages {
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Build</span><span style="color:#710">'</span></span>) {
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mvn -B</span><span style="color:#710">'</span></span>
            }
        }
    }
}</code></pre>
</div></div>  <div class="pipeline-script-expand">
    <a href="#" onclick="javascript:$(this).parent().siblings('.pipeline-script').toggle(); return false;">Toggle Scripted Pipeline</a>
    <em>(Advanced)</em>
  </div>
  <div class="listingblock pipeline-script"
        style="display: none">
    <div class="title">Jenkinsfile (Scripted Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">node {
    <span style="color:#777">/* Requires the Docker Pipeline plugin to be installed */</span>
    docker.image(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">maven:3-alpine</span><span style="color:#710">'</span></span>).inside(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">-v $HOME/.m2:/root/.m2</span><span style="color:#710">'</span></span>) {
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Build</span><span style="color:#710">'</span></span>) {
            sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mvn -B</span><span style="color:#710">'</span></span>
        }
    }
}</code></pre>
</div></div></div>
</div>
<div class="sect2">
<h3 id="using-multiple-containers"><a class="anchor" href="#using-multiple-containers"></a>Using multiple containers</h3>
<div class="paragraph">
<p>It has become increasingly common for code bases to rely on
multiple, different, technologies. For example, a repository might have both a
Java-based back-end API implementation <em>and</em> a JavaScript-based front-end
implementation. Combining Docker and Pipeline allows a <code>Jenkinsfile</code> to use
<strong>multiple</strong> types of technologies by combining the <code>agent {}</code> directive, with
different stages.</p>
</div>
<div class="pipeline-block">  <div class="listingblock pipeline-declarative">
    <div class="title">Jenkinsfile (Declarative Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">pipeline {
    agent none
    stages {
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Back-end</span><span style="color:#710">'</span></span>) {
            agent {
                docker { image <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">maven:3-alpine</span><span style="color:#710">'</span></span> }
            }
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mvn --version</span><span style="color:#710">'</span></span>
            }
        }
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Front-end</span><span style="color:#710">'</span></span>) {
            agent {
                docker { image <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">node:7-alpine</span><span style="color:#710">'</span></span> }
            }
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">node --version</span><span style="color:#710">'</span></span>
            }
        }
    }
}</code></pre>
</div></div>  <div class="pipeline-script-expand">
    <a href="#" onclick="javascript:$(this).parent().siblings('.pipeline-script').toggle(); return false;">Toggle Scripted Pipeline</a>
    <em>(Advanced)</em>
  </div>
  <div class="listingblock pipeline-script"
        style="display: none">
    <div class="title">Jenkinsfile (Scripted Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">node {
    <span style="color:#777">/* Requires the Docker Pipeline plugin to be installed */</span>

    stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Back-end</span><span style="color:#710">'</span></span>) {
        docker.image(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">maven:3-alpine</span><span style="color:#710">'</span></span>).inside {
            sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mvn --version</span><span style="color:#710">'</span></span>
        }
    }

    stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Front-end</span><span style="color:#710">'</span></span>) {
        docker.image(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">node:7-alpine</span><span style="color:#710">'</span></span>).inside {
            sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">node --version</span><span style="color:#710">'</span></span>
        }
    }
}</code></pre>
</div></div></div>
</div>
<div class="sect2">
<h3 id="dockerfile"><a class="anchor" href="#dockerfile"></a>Using a Dockerfile</h3>
<div class="paragraph">
<p>For projects which require a more customized execution environment, Pipeline
also supports building and running a container from a <code>Dockerfile</code> in the source
repository. In contrast to the <a href="#execution-environment">previous approach</a> of using
an "off-the-shelf" container, using the <code>agent { dockerfile true }</code> syntax will
build a new image from a <code>Dockerfile</code> rather than pulling one from
<a href="https://hub.docker.com">Docker Hub</a>.</p>
</div>
<div class="paragraph">
<p>Re-using an example from above, with a more custom <code>Dockerfile</code>:</p>
</div>
<div class="listingblock">
<div class="title">Dockerfile</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code>FROM node:7-alpine

RUN apk add -U subversion</code></pre>
</div>
</div>
<div class="paragraph">
<p>By committing this to the root of the source repository, the <code>Jenkinsfile</code> can
be changed to build a container based on this <code>Dockerfile</code> and then run the
defined steps using that container:</p>
</div>
<div class="pipeline-block">  <div class="listingblock pipeline-declarative">
    <div class="title">Jenkinsfile (Declarative Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">pipeline {
    agent { dockerfile <span style="color:#069">true</span> }
    stages {
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Test</span><span style="color:#710">'</span></span>) {
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">node --version</span><span style="color:#710">'</span></span>
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">svn --version</span><span style="color:#710">'</span></span>
            }
        }
    }
}</code></pre>
</div></div></div>
<div class="paragraph">
<p>The <code>agent { dockerfile true }</code> syntax supports a number of other options which
are described in more detail in the
<a href="../syntax#agent">Pipeline Syntax</a> section.</p>
</div>
<div class="videoblock">
<div class="title">Using a Dockerfile with Jenkins Pipeline</div>
<div class="content">
<iframe width="852" height="480" src="https://www.youtube.com/embed/Pi2kJ2RJS50?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
</div>
<div class="sect2">
<h3 id="specifying-a-docker-label"><a class="anchor" href="#specifying-a-docker-label"></a>Specifying a Docker Label</h3>
<div class="paragraph">
<p>By default, Pipeline assumes that <em>any</em> configured
<a href="../../glossary/#agent">agent</a> is capable of running Docker-based Pipelines.
For Jenkins environments which have macOS, Windows, or other agents, which are
unable to run the Docker daemon, this default setting may be problematic.
Pipeline provides a global option in the <strong>Manage Jenkins</strong> page, and on
the
<a href="../../glossary/#folder">Folder</a>
level, for specifying which agents (by
<a href="../../glossary/#label">Label</a>)
to use for running Docker-based Pipelines.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../resources/pipeline/configure-docker-label.png" alt="Configuring the Pipeline Docker Label">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advanced-usage-with-scripted-pipeline"><a class="anchor" href="#advanced-usage-with-scripted-pipeline"></a>Advanced Usage with Scripted Pipeline</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="running-sidecar-containers"><a class="anchor" href="#running-sidecar-containers"></a>Running "sidecar" containers</h3>
<div class="paragraph">
<p>Using Docker in Pipeline can be an effective way to run a service on which the
build, or a set of tests, may rely. Similar to the
<a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/sidecar">sidecar
pattern</a>, Docker Pipeline can run one container "in the background", while
performing work in another. Utilizing this sidecar approach, a Pipeline can
have a "clean" container provisioned for each Pipeline run.</p>
</div>
<div class="paragraph">
<p>Consider a hypothetical integration test suite which relies on a local MySQL
database to be running. Using the <code>withRun</code> method, implemented in the
<a href="https://plugins.jenkins.io/docker-workflow">Docker Pipeline</a> plugin&#8217;s support for Scripted Pipeline,
a <code>Jenkinsfile</code> can run MySQL as a sidecar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">node {
    checkout scm
    <span style="color:#777">/*
     * In order to communicate with the MySQL server, this Pipeline explicitly
     * maps the port (`3306`) to a known port on the host machine.
     */</span>
    docker.image(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mysql:5</span><span style="color:#710">'</span></span>).withRun(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">-e &quot;MYSQL_ROOT_PASSWORD=my-secret-pw&quot; -p 3306:3306</span><span style="color:#710">'</span></span>) { c -&gt;
        <span style="color:#777">/* Wait until mysql service is up */</span>
        sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">while ! mysqladmin ping -h0.0.0.0 --silent; do sleep 1; done</span><span style="color:#710">'</span></span>
        <span style="color:#777">/* Run some tests which require MySQL */</span>
        sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">make check</span><span style="color:#710">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example can be taken further, utilizing two containers simultaneously.
One "sidecar" running MySQL, and another providing the <a href="#execution-environment">execution environment</a>, by using the Docker
<a href="https://docs.docker.com/engine/userguide/networking/default_network/dockerlinks/">container links</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">node {
    checkout scm
    docker.image(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mysql:5</span><span style="color:#710">'</span></span>).withRun(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">-e &quot;MYSQL_ROOT_PASSWORD=my-secret-pw&quot;</span><span style="color:#710">'</span></span>) { c -&gt;
        docker.image(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mysql:5</span><span style="color:#710">'</span></span>).inside(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">--link </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>c.id<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">:db</span><span style="color:#710">&quot;</span></span>) {
            <span style="color:#777">/* Wait until mysql service is up */</span>
            sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">while ! mysqladmin ping -hdb --silent; do sleep 1; done</span><span style="color:#710">'</span></span>
        }
        docker.image(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">centos:7</span><span style="color:#710">'</span></span>).inside(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">--link </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>c.id<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">:db</span><span style="color:#710">&quot;</span></span>) {
            <span style="color:#777">/*
             * Run some tests which require MySQL, and assume that it is
             * available on the host name `db`
             */</span>
            sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">make check</span><span style="color:#710">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example uses the object exposed by <code>withRun</code>, which has the
running container&#8217;s ID available via the <code>id</code> property. Using the container&#8217;s
ID, the Pipeline can create a link by passing custom Docker arguments to the
<code>inside()</code> method.</p>
</div>
<div class="paragraph">
<p>The <code>id</code> property can also be useful for inspecting logs from a running Docker
container before the Pipeline exits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">docker logs </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>c.id<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="building-containers"><a class="anchor" href="#building-containers"></a>Building containers</h3>
<div class="paragraph">
<p>In order to create a Docker image, the <a href="https://plugins.jenkins.io/docker-workflow">Docker Pipeline</a>
plugin also provides a <code>build()</code> method for creating a new image, from a
<code>Dockerfile</code> in the repository, during a Pipeline run.</p>
</div>
<div class="paragraph">
<p>One major benefit of using the syntax <code>docker.build("my-image-name")</code> is that a
Scripted Pipeline can use the return value for subsequent Docker Pipeline
calls, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">node {
    checkout scm

    <span style="color:#080;font-weight:bold">def</span> customImage = docker.build(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my-image:</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>env.BUILD_ID<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>)

    customImage.inside {
        sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">make test</span><span style="color:#710">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The return value can also be used to publish the Docker image to
<a href="https://hub.docker.com">Docker Hub</a>,
or a <a href="#custom-registry">custom Registry</a>,
via the <code>push()</code> method, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">node {
    checkout scm
    <span style="color:#080;font-weight:bold">def</span> customImage = docker.build(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my-image:</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>env.BUILD_ID<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>)
    customImage.push()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>One common usage of image "tags" is to specify a <code>latest</code> tag for the most
recently, validated, version of a Docker image. The <code>push()</code> method accepts an
optional <code>tag</code> parameter, allowing the Pipeline to push the <code>customImage</code> with
different tags, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">node {
    checkout scm
    <span style="color:#080;font-weight:bold">def</span> customImage = docker.build(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my-image:</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>env.BUILD_ID<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>)
    customImage.push()

    customImage.push(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">latest</span><span style="color:#710">'</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>build()</code> method builds the <code>Dockerfile</code> in the current directory by
default. This can be overridden by providing a directory path
containing a <code>Dockerfile</code> as the second argument of the <code>build()</code> method, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">node {
    checkout scm
    <span style="color:#080;font-weight:bold">def</span> testImage = docker.build(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">test-image</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">./dockerfiles/test</span><span style="color:#710">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>

    testImage.inside {
        sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">make test</span><span style="color:#710">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Builds <code>test-image</code> from the Dockerfile found at <code>./dockerfiles/test/Dockerfile</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is possible to pass other arguments to
<a href="https://docs.docker.com/engine/reference/commandline/build/">docker build</a>
by adding them to the second argument of the <code>build()</code> method.
When passing arguments this way, the last value in the that string must be
the path to the docker file.</p>
</div>
<div class="paragraph">
<p>This example overrides the default <code>Dockerfile</code> by passing the <code>-f</code>
flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">node {
    checkout scm
    <span style="color:#080;font-weight:bold">def</span> dockerfile = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Dockerfile.test</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">def</span> customImage = docker.build(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my-image:</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>env.BUILD_ID<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">-f </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>dockerfile<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20"> ./dockerfiles</span><span style="color:#710">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Builds <code>my-image:${env.BUILD_ID}</code> from the Dockerfile found at <code>./dockerfiles/Dockerfile.test</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="using-a-remote-docker-server"><a class="anchor" href="#using-a-remote-docker-server"></a>Using a remote Docker server</h3>
<div class="paragraph">
<p>By default, the <a href="https://plugins.jenkins.io/docker-workflow">Docker Pipeline</a> plugin will communicate
with a local Docker daemon, typically accessed through <code>/var/run/docker.sock</code>.</p>
</div>
<div class="paragraph">
<p>To select a non-default Docker server, such as with
<a href="https://docs.docker.com/swarm/">Docker Swarm</a>,
the <code>withServer()</code> method should be used.</p>
</div>
<div class="paragraph">
<p>By passing a URI, and optionally the Credentials ID of a <strong>Docker Server
Certificate Authentication</strong> pre-configured in Jenkins, to the method with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">node {
    checkout scm

    docker.withServer(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">tcp://swarm.example.com:2376</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">swarm-certs</span><span style="color:#710">'</span></span>) {
        docker.image(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mysql:5</span><span style="color:#710">'</span></span>).withRun(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">-p 3306:3306</span><span style="color:#710">'</span></span>) {
            <span style="color:#777">/* do things */</span>
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>inside()</code> and <code>build()</code> will not work properly with a Docker Swarm server out
of the box</p>
</div>
<div class="paragraph">
<p>For <code>inside()</code> to work, the Docker server and the Jenkins agent must use the
same filesystem, so that the workspace can be mounted.</p>
</div>
<div class="paragraph">
<p>Currently neither the Jenkins plugin nor the Docker CLI will automatically
detect the case that the server is running remotely; a typical symptom would be
errors from nested <code>sh</code> commands such as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>cannot create /…@tmp/durable-…/pid: Directory nonexistent</code></pre>
</div>
</div>
<div class="paragraph">
<p>When Jenkins detects that the agent is itself running inside a Docker
container, it will automatically pass the <code>--volumes-from</code> argument to the
<code>inside</code> container, ensuring that it can share a workspace with the agent.</p>
</div>
<div class="paragraph">
<p>Additionally some versions of Docker Swarm do not support custom Registries.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="custom-registry"><a class="anchor" href="#custom-registry"></a>Using a custom registry</h3>
<div class="paragraph">
<p>By default the <a href="https://plugins.jenkins.io/docker-workflow">Docker Pipeline</a> integrates assumes the
default Docker Registry of
<a href="https://hub.docker.com">Docker Hub</a>.</p>
</div>
<div class="paragraph">
<p>In order to use a custom Docker Registry, users of Scripted Pipeline can wrap
steps with the <code>withRegistry()</code> method, passing in the custom Registry URL, for
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">node {
    checkout scm

    docker.withRegistry(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">https://registry.example.com</span><span style="color:#710">'</span></span>) {

        docker.image(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">my-custom-image</span><span style="color:#710">'</span></span>).inside {
            sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">make test</span><span style="color:#710">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a Docker Registry which requires authentication, add a "Username/Password"
Credentials item from the Jenkins home page and use the Credentials ID as a
second argument to <code>withRegistry()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">node {
    checkout scm

    docker.withRegistry(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">https://registry.example.com</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">credentials-id</span><span style="color:#710">'</span></span>) {

        <span style="color:#080;font-weight:bold">def</span> customImage = docker.build(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my-image:</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>env.BUILD_ID<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>)

        <span style="color:#777">/* Push the container to the custom Registry */</span>
        customImage.push()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<hr>
<div class="container">
<div class="row">
<div class="col-md-4">
<div class="row">
<a class="prev doc-page-link" href="../multibranch">
⇐ Branches and Pull Requests
</a>
</div>
</div>
<div class="col-md-4">
<div class="row">
<a class="up doc-page-link" href="../">
⇑ Pipeline
</a>
</div>
<div class="row">
<a class="index doc-page-link" href="../../">
Index
</a>
</div>
</div>
<div class="col-md-4">
<div class="row">
<a class="next doc-page-link" href="../shared-libraries">
Extending with Shared Libraries ⇒
</a>
</div>
</div>
</div>
</div>
<hr>
<div class="container"></div>
<!-- starting partial _feedback-footer.html -->
<!-- HTML inclusion for chapter and section layouts (i.e. as footers) as well as
     for use in AsciiDoc file inclusions. -->

<!--
This feedback form was prepared from a Google Form, based on the techniques in
the following documentation sources:
https://codepen.io/learningcode/post/customize-a-google-form-for-your-website,
https://mrhaki.blogspot.com.au/2014/06/awesome-asciidoc-include-raw-html.html,
https://www.freshtechtips.com/2013/05/custom-google-drive-contact-form.html,
https://stackoverflow.com/questions/24436165/set-value-of-hidden-input-inside-form
-->

<!-- Feedback form functionality in JavaScript - refer to comments in this file
     for details on the functionality. -->
<script>
var feedbackForm = {
    formKey : 'e/1FAIpQLSfCEexH09x_-ytEyE7wetizqOvE_-06WkK89dpBLEJcYnOp8w'
};
$(document).ready(function() {
    window.onload = feedbackForm.start(window.location.href);
});
</script>
<script src="/js/feedback-form-functionality.js"></script>

<p><a href="#feedback" data-toggle="collapse">Was this page helpful?</a></p>

<div id="feedback" class="collapse">

<p>Please submit your feedback about this page through this
<a href="/doc/feedback-form/">quick form</a>.</p>

<p>Alternatively, if you don't wish to complete the quick form, you can simply
indicate if you found this page helpful?</p>

<!-- Redirects to custom "thank you" page once form is submitted. -->
<script type="text/javascript">
var submitted=false;
</script>
<iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"
onload="if(submitted) {window.location='/doc/thank-you-for-your-feedback/';}">
</iframe>
<form action="https://docs.google.com/forms/d/e/1FAIpQLSfCEexH09x_-ytEyE7wetizqOvE_-06WkK89dpBLEJcYnOp8w/formResponse" method="POST" id="ss-form" target="hidden_iframe" onsubmit="submitted=true;">

<!-- Set the value of the current URL into the form. -->
<input type="hidden" name="entry.1246830226" id="current-url" value=""/>

<!-- The answer bit -->
<p><input type="radio" name="entry.790002525" id="h1" value="Yes" required/>
<label for="h1">Yes</label>&nbsp;&nbsp;&nbsp;&nbsp;
<input type="radio" name="entry.790002525" id="h2" value="No"/>
<label for="h2">No</label></p>

<!-- The CAPTCHA bit -->

<p><label id="ssTestLabel" for="ssTestValue"></label><br/>
<input type="text" name="ssTestValue" value="" id="ssTestValue"/></p>

<!-- Submit button -->

<p><input class="button" type="submit" value="Submit"/></p>

</form>

<p>See existing feedback <a href="https://docs.google.com/spreadsheets/d/1IIdpVs39JDYKg0sLQIv-MNO928qcGApAIfdW5ohfD78" target="_blank">here</a>.</p>

</div>

<!-- ending partial _feedback-footer.html -->

</div>
</div>
</div>


<script src="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/assets/bower/anchor-js/anchor.min.js"></script>
<script src="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/assets/bower/tether/js/tether.min.js"></script>
<script src="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<footer id="footer">
<div class="container">
<div class="row">
<div class="col-md-4">
<p class="box">
<a href="https://github.com/jenkins-infra/jenkins.io/edit/master/content//doc/book/pipeline/docker.adoc" title="Edit /doc/book/pipeline/docker.adoc on GitHub">Improve this page</a>
|
<a href="https://github.com/jenkins-infra/jenkins.io/commits/master/content//doc/book/pipeline/docker.adoc" title="View /doc/book/pipeline/docker.adoc history on GitHub">Page history</a>
</p>
<div class="license-box">
<div id="creativecommons">
<a href="https://creativecommons.org/licenses/by-sa/4.0/">
<p>
<img alt="Creative Commons Attribution-ShareAlike license" src="https://licensebuttons.net/l/by-sa/4.0/88x31.png">
</p>
</a>
<p>
The content driving this site is licensed under the Creative
Commons Attribution-ShareAlike 4.0 license.
</p>
</div>
</div>
</div>
<div class="links col-md-8">
<div class="container">
<div class="row">
<div class="area col-md-3">
<div class="div-mar">
<h5>Resources</h5>
<ul class="resources">
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/events">
Events
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc">
Documentation
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/node">
Blog
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Solutions</h5>
<ul>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/android">
Android
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/c">
C/C++
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/docker">
Docker
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/embedded">
Embedded
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/github">
GitHub
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/java">
Java
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/php">
PHP
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/pipeline">
Continuous Delivery
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/python">
Python
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/ruby">
Ruby
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Project</h5>
<ul class="project">
<li>
<a href="https://issues.jenkins-ci.org">
Issue tracker
</a>
</li>
<li>
<a href="https://wiki.jenkins.io">
Wiki
</a>
</li>
<li>
<a href="https://github.com/jenkinsci">
GitHub
</a>
</li>
<li>
<a href="https://ci.jenkins.io">
Jenkins on Jenkins
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Community</h5>
<ul class="community">
<li>
<a href="https://groups.google.com/forum/#!forum/jenkinsci-users">
Users mailing list
</a>
</li>
<li>
<a href="https://groups.google.com/forum/#!forum/jenkinsci-dev">
Developers mailing list
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs">
Special Interest Groups
</a>
</li>
<li>
<a href="https://twitter.com/jenkinsci">
Twitter
</a>
</li>
<li>
<a href="https://reddit.com/r/jenkinsci">
Reddit
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/merchandise">
Merchandise
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/awards">
Awards
</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  !function(d,s,id) {
    var js, fjs=d.getElementsByTagName(s)[0];
    if (!d.getElementById(id)) {
      js = d.createElement(s);
      js.id=id;
      js.src="//platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js,fjs);
    }
  }(document,"script","twitter-wjs");
  
  $(function(){
    var $body = $(document.body);
    $(".nav-link.dropdown-toggle").on("mousedown", function(){
      $body.addClass("no-outline");
    })
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
</body>
</html>
