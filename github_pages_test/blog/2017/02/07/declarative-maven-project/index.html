<!DOCTYPE html>
<html lang="en">
<head>
<title>
Declarative Pipeline for Maven Projects
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="description">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sites/default/files/jenkins_favicon.ico" rel="shortcut icon" type="image/x-icon">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/img/favicon.ico" rel="icon" sizes="32x32" type="img/png">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/img/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/img/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/img/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/img/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/img/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152">
<meta content="Declarative Pipeline for Maven Projects" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="Declarative Pipeline for Maven Projects" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/images/logo-title-opengraph.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="Declarative Pipeline for Maven Projects" property="og:title">
<meta content="article" property="og:type">
<meta content="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/blog/2017/02/07/declarative-maven-project/index.html" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="og:description">
<meta content="Declarative Pipeline for Maven Projects" property="og:site_name">
<meta content="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/images/logo-title-opengraph.png" name="og:image">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/assets/bower/tether/css/tether.min.css" media="screen" rel="stylesheet">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/css/font-icons.css" media="screen" rel="stylesheet">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/css/jenkins.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/assets/bower/ionicons/css/ionicons.min.css" media="screen" rel="stylesheet">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/css/footer.css" media="screen" rel="stylesheet">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/css/font-awesome.min.css" media="screen" rel="stylesheet">
</head>
<body>
<script src="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<nav class="navbar navbar-expand-md navbar-dark top bg-dark fixed-top" id="ji-toolbar">
<a class="navbar-brand" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test">
Jenkins
</a>
<button class="navbar-toggler" data-target="#CollapsingNavbar" data-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="CollapsingNavbar">
<ul class="nav navbar-nav ml-auto">
<li class="nav-item">
<a class="nav-link" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/node">
Blog
</a>
</li>
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
Documentation
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc">
Use Jenkins
</a>
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/developer">
Extend Jenkins
</a>
<span class="dropdown-item">
<strong>
Use-cases
</strong>
</span>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/android">
&nbsp;-&nbsp;Android
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/c">
&nbsp;-&nbsp;C/C++
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/docker">
&nbsp;-&nbsp;Docker
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/embedded">
&nbsp;-&nbsp;Embedded
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/github">
&nbsp;-&nbsp;GitHub
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/java">
&nbsp;-&nbsp;Java
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/php">
&nbsp;-&nbsp;PHP
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/pipeline">
&nbsp;-&nbsp;Continuous Delivery
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/python">
&nbsp;-&nbsp;Python
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/ruby">
&nbsp;-&nbsp;Ruby
</a>
</div>
</li>
<li class="nav-item">
<a class="nav-link" href="https://plugins.jenkins.io/">
Plugins
</a>
</li>
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
Community
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/participate">
Overview
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/chat" title="Chat with the rest of the Jenkins community on IRC">
Chat
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/jam">
Meet
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/events">
Events
</a>
<a class="dropdown-item feature" href="https://issues.jenkins-ci.org/">
Issue Tracker
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/mailing-lists" title="Browse Jenkins mailing list archives and/or subscribe to lists">
Mailing Lists
</a>
<a class="dropdown-item feature" href="https://wiki.jenkins.io/">
Wiki
</a>
<a class="dropdown-item feature" href="https://accounts.jenkins.io/" title="Create/manage your account for accessing wiki, issue tracker, etc">
Account Management
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/">
<strong>
Special Interest Groups
</strong>
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/advocacy-and-outreach/">
&nbsp;-&nbsp;Advocacy and Outreach
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/chinese-localization/">
&nbsp;-&nbsp;Chinese Localization
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/cloud-native/">
&nbsp;-&nbsp;Cloud Native
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/docs/">
&nbsp;-&nbsp;Documentation
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/gsoc/">
&nbsp;-&nbsp;Google Summer of Code
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/hw-and-eda/">
&nbsp;-&nbsp;Hardware and EDA
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/pipeline-authoring/">
&nbsp;-&nbsp;Pipeline Authoring
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/platform/">
&nbsp;-&nbsp;Platform
</a>
</div>
</li>
<li class="dropdown nav-item">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
Subprojects
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/">
Overview
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/blueocean/">
Blue Ocean
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/evergreen/">
Evergreen
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/gsoc/">
Google Summer of Code in Jenkins
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/infrastructure/">
Infrastructure
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/jam/">
Jenkins Area Meetups
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/jcasc/">
Jenkins Configuration as Code
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/remoting/">
Jenkins Remoting
</a>
</div>
</li>
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
About
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/security">
Security
</a>
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/press">
Press
</a>
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/awards">
Awards
</a>
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/project/conduct">
Conduct
</a>
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/artwork">
Artwork
</a>
</div>
</li>
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
English
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/zh">
中文 Chinese
</a>
</div>
</li>
<li class="nav-item">
<a class="nav-link btn btn-outline-secondary" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/download">
Download
</a>
</li>
</ul>
</div>
</nav>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<script>
  $(function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('#content h' + i);
    }
  })
</script>
<div class="container blog-post">
<div class="row body">
<div class="col-md-11 col-md-offset-1 main-content" id="content">
<div id="content-top">
<h1>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/blog/2017/02/07/declarative-maven-project/" title="Declarative Pipeline for Maven Projects">
Declarative Pipeline for Maven Projects
</a>
</h1>
<div style="float: right; clear: all;">
<a class="twitter-share-button" data-lang="en" href="https://twitter.com/share">
Tweet
</a>
</div>
<div class="post-attrs">
<span class="submitted">
Published on
2017-02-07
by
<a href="/blog/authors/lnewman">Liam Newman</a>
</span>
<ul class="list-inline tags">
<li>
<a class="tag-link" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/node/tags/tutorial">
tutorial
</a>
</li>
<li>
<a class="tag-link" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/node/tags/pipeline">
pipeline
</a>
</li>
<li>
<a class="tag-link" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/node/tags/declarative">
declarative
</a>
</li>
<li>
<a class="tag-link" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/node/tags/maven">
maven
</a>
</li>
<li>
<a class="tag-link" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/node/tags/java">
java
</a>
</li>
</ul>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This is a guest post by <a href="https://github.com/bitwiseman">Liam Newman</a>,
Technical Evangelist at <a href="https://cloudbees.com">CloudBees</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Declare Your Pipelines!</strong>
<a href="/blog/2017/02/03/declarative-pipeline-ga/">Declarative Pipeline 1.0 is here</a>!
This is first in a series of blog posts that will show some of the cool features of
<a href="/doc/book/pipeline/syntax/#declarative-pipeline">Declarative Pipeline</a>.
For several of these posts, I&#8217;ll be revisiting some of my
<a href="/blog/2016/07/18/pipeline-notifications/">previous posts</a>
on using various plugins with (Scripted) Pipeline,
and seeing how those are implemented in Declarative Pipeline.</p>
</div>
<div class="paragraph">
<p>To start though, let&#8217;s get familiar with the basic structure of a Declarative Pipeline
by creating a simple Pipeline for a Maven-based Java project - the
<a href="https://plugins.jenkins.io/junit">Jenkins JUnit plugin</a>.
We&#8217;ll create a minimal Declarative Pipeline,
add the settings needed to install Maven and the JDK,
and finally we&#8217;ll actually run Maven to build the plugin.</p>
</div>
<div class="sect1">
<h2 id="set-up"><a class="anchor" href="#set-up"></a>Set up</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With Declarative, it is still possible to run Pipelines edited directly in the
Jenkins web UI, but one of the key features of "Pipeline as Code" is
checking-in and being able to track changes.  For this post, I&#8217;m going to use
the
<a href="https://github.com/bitwiseman/junit-plugin/tree/blog/add-declarative-pipeline"><code>blog/add-declarative-pipeline</code></a>
branch of
<a href="https://github.com/bitwiseman/junit-plugin">my fork</a> of the JUnit plugin.
I&#8217;m going to set up a Multi-branch Pipeline and point it at my repository.</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="/images/post-images/2017-02-07/junit-config.png" alt="JUnit Multi-branch Pipeline Configuration">
</div>
</div>
<div class="paragraph">
<p>I&#8217;ve also set this Pipeline&#8217;s Git configuration to automatically "clean after
checkout" and to only keep the ten most recent runs.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-a-minimal-pipeline"><a class="anchor" href="#writing-a-minimal-pipeline"></a>Writing a Minimal Pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As has been said before, Declarative Pipeline provides a more structured,
"opinionated" way to create Pipelines. I&#8217;m going to start by creating a minimal
Declarative Pipeline and adding it to my branch.  Below is a minimal Pipeline
(with annotations) that just prints a message:</p>
</div>
<div class="pipeline-block">  <div class="listingblock pipeline-declarative">
    <div class="title">Jenkinsfile (Declarative Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">pipeline { <span style="color:#777"><i class="conum" data-value="1"></i><b>(1)</b></span>
    agent any <span style="color:#777"><i class="conum" data-value="2"></i><b>(2)</b> <i class="conum" data-value="3"></i><b>(3)</b></span>
    stages { <span style="color:#777"><i class="conum" data-value="4"></i><b>(4)</b></span>
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Build</span><span style="color:#710">'</span></span>) { <span style="color:#777"><i class="conum" data-value="5"></i><b>(5)</b></span>
            steps { <span style="color:#777"><i class="conum" data-value="6"></i><b>(6)</b></span>
               echo <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">This is a minimal pipeline.</span><span style="color:#710">'</span></span> <span style="color:#777"><i class="conum" data-value="7"></i><b>(7)</b></span>
            }
        }
    }
}</code></pre>
</div></div>  <div class="pipeline-script-expand">
    <a href="#" onclick="javascript:$(this).parent().siblings('.pipeline-script').toggle(); return false;">Toggle Scripted Pipeline</a>
    <em>(Advanced)</em>
  </div>
  <div class="listingblock pipeline-script"
        style="display: none">
    <div class="title">Jenkinsfile (Scripted Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">node { <span style="color:#777"><i class="conum" data-value="2"></i><b>(2)</b></span>
    checkout scm <span style="color:#777"><i class="conum" data-value="3"></i><b>(3)</b></span>
    stage (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Build</span><span style="color:#710">'</span></span>) { <span style="color:#777"><i class="conum" data-value="5"></i><b>(5)</b></span>
        echo <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">This is a minimal pipeline.</span><span style="color:#710">'</span></span> <span style="color:#777"><i class="conum" data-value="6"></i><b>(6)</b></span>
    }
}</code></pre>
</div></div></div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All Declarative Pipelines start with a <code>pipeline</code> section.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Select where to run this Pipeline, in this case "any" agent, regardless of label.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Declarative automatically performs a checkout of source code on the agent,
whereas Scripted Pipeline users must explicitly call <code>checkout scm</code>,</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>A Declarative Pipeline is defined as a series of stages.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Run the "Build" stage.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Each stage in a Declarative Pipeline runs a series of steps.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Run the <code>echo</code> step to print a message in the Console Output.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are familiar with Scripted Pipeline, you can toggle the above
Declarative code sample to show the Scripted equivalent.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once I add the Pipeline above to my <code>Jenkinsfile</code> and run "Branch Indexing", my
Jenkins will pick it up and run run it.  We see that the Declarative Pipeline
has added stage called "Declarative: Checkout SCM":</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="/images/post-images/2017-02-07/junit-minimal.png" alt="Minimal Declarative Pipeline">
</div>
</div>
<div class="paragraph">
<p>This a "dynamic stage", one of several the kinds that Declarative Pipeline adds
as needed for clearer reporting.  In this case, it is a stage in which the
Declarative Pipeline automatically checkouts out source code on the agent.</p>
</div>
<div class="paragraph">
<p>As you can see above, we didn&#8217;t have to tell it do any of this,</p>
</div>
<div class="listingblock">
<div class="title">Console Output</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[Pipeline] node
Running on osx_mbp in /Users/bitwiseman/jenkins/agents/osx_mbp/workspace/blog_add-declarative-pipeline
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Declarative: Checkout SCM)
[Pipeline] checkout
Cloning the remote Git repository
{ ... truncated 20 lines ... }
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Build)
[Pipeline] echo
This is a minimal pipeline
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // node
[Pipeline] End of Pipeline
Finished: SUCCESS</code></pre>
</div>
</div>
<div class="paragraph">
<p>Declarative Pipeline syntax is a little more verbose than the equivalent Scripted Pipeline,
but the added detail gives a clearer, more consistent view of what the Pipeline is supposed to do.
It also gives us a structure into which we can add more configuration details about this Pipeline.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adding-tools-to-pipeline"><a class="anchor" href="#adding-tools-to-pipeline"></a>Adding Tools to Pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The next thing we&#8217;ll add in this Pipeline is a <code>tools</code> section to let us use
Maven.  The <code>tools</code> section is one of several sections we can add under
<code>pipeline</code>, which affect the configuration of the rest of the Pipeline.  (We&#8217;ll
look at the others, including <code>agent</code>, in later posts.) Each tool entry will
make whatever settings changes, such as updating <code>PATH</code> or other environment
variables, to make the named tool available in the current pipeline.  It will
also automatically install the named tool if that tool is configured to do so
under "Managing Jenkins" &#8594; "Global Tool Configuration".</p>
</div>
<div class="pipeline-block">  <div class="listingblock pipeline-declarative">
    <div class="title">Jenkinsfile (Declarative Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">pipeline {
    agent any
    tools { <span style="color:#777"><i class="conum" data-value="1"></i><b>(1)</b></span>
        maven <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Maven 3.3.9</span><span style="color:#710">'</span></span> <span style="color:#777"><i class="conum" data-value="2"></i><b>(2)</b></span>
        jdk <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">jdk8</span><span style="color:#710">'</span></span> <span style="color:#777"><i class="conum" data-value="3"></i><b>(3)</b></span>
    }
    stages {
        stage (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Initialize</span><span style="color:#710">'</span></span>) {
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'''</span><span style="color:#D20">
                    echo &quot;PATH = ${PATH}&quot;
                    echo &quot;M2_HOME = ${M2_HOME}&quot;
                </span><span style="color:#710">'''</span></span> <span style="color:#777"><i class="conum" data-value="4"></i><b>(4)</b></span>
            }
        }

        stage (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Build</span><span style="color:#710">'</span></span>) {
            steps {
                echo <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">This is a minimal pipeline.</span><span style="color:#710">'</span></span>
            }
        }
    }
}</code></pre>
</div></div></div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>tools</code> section for adding tool settings.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configure this Pipeline to use the Maven version matching "Maven 3.3.9"
(configured in "Managing Jenkins" &#8594; "Global Tool Configuration").</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Configure this Pipeline to use the Maven version matching "jdk8"
(configured in "Managing Jenkins" &#8594; "Global Tool Configuration").</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>These will show the values of <code>PATH</code> and <code>M2_HOME</code> environment variables.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When we run this updated Pipeline the same way we ran the first, we see that
the Declarative Pipeline has added another stage called "Declarative: Tool
Install": In the console output, we see that during this particular stage "Maven 3.3.9" gets installed,
and the <code>PATH</code> and <code>M2_HOME</code> environment variables are set:</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="/images/post-images/2017-02-07/junit-tools.png" alt="Declarative Pipeline with Tools Section">
</div>
</div>
<div class="listingblock">
<div class="title">Console Output</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code>{ ... truncated lines ... }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Declarative: Tool Install)
[Pipeline] tool
Unpacking https://repo.maven.apache.org/maven2/org/apache/maven/apache-maven/3.3.9/apache-maven-3.3.9-bin.zip
to /Users/bitwiseman/jenkins/agents/osx_mbp/tools/hudson.tasks.Maven_MavenInstallation/Maven_3.3.9
on osx_mbp
[Pipeline] envVarsForTool
[Pipeline] tool
[Pipeline] envVarsForTool
[Pipeline] }
[Pipeline] // stage
{ ... }
PATH = /Library/Java/JavaVirtualMachines/jdk1.8.0_92.jdk/Contents/Home/bin:/Users/bitwiseman/jenkins/agents/osx_mbp/tools/hudson.tasks.Maven_MavenInstallation/Maven_3.3.9/bin:...
M2_HOME = /Users/bitwiseman/jenkins/agents/osx_mbp/tools/hudson.tasks.Maven_MavenInstallation/Maven_3.3.9
{ ... }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-a-maven-build"><a class="anchor" href="#running-a-maven-build"></a>Running a Maven Build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Finally, running a Maven build is trivial.  The <code>tools</code> section already added
Maven and JDK8 to the <code>PATH</code>, all we need to do is call <code>mvn install</code>.  It
would be nice if I could split the build and the tests into separate stages,
but Maven is famous for not liking when people do that, so I&#8217;ll leave it alone
for now.</p>
</div>
<div class="paragraph">
<p>Instead, let&#8217;s load up the results of the build using the JUnit plugin,
however the version that was just built, sorry.</p>
</div>
<div class="pipeline-block">  <div class="listingblock pipeline-declarative">
    <div class="title">Jenkinsfile (Declarative Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">pipeline {
    agent any
    tools {
        maven <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Maven 3.3.9</span><span style="color:#710">'</span></span>
        jdk <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">jdk8</span><span style="color:#710">'</span></span>
    }
    stages {
        stage (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Initialize</span><span style="color:#710">'</span></span>) {
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'''</span><span style="color:#D20">
                    echo &quot;PATH = ${PATH}&quot;
                    echo &quot;M2_HOME = ${M2_HOME}&quot;
                </span><span style="color:#710">'''</span></span>
            }
        }

        stage (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Build</span><span style="color:#710">'</span></span>) {
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mvn -Dmaven.test.failure.ignore=true install</span><span style="color:#710">'</span></span> <span style="color:#777"><i class="conum" data-value="1"></i><b>(1)</b></span>
            }
            post {
                success {
                    junit <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">target/surefire-reports/**/*.xml</span><span style="color:#710">'</span></span> <span style="color:#777"><i class="conum" data-value="2"></i><b>(2)</b></span>
                }
            }
        }
    }
}</code></pre>
</div></div>  <div class="pipeline-script-expand">
    <a href="#" onclick="javascript:$(this).parent().siblings('.pipeline-script').toggle(); return false;">Toggle Scripted Pipeline</a>
    <em>(Advanced)</em>
  </div>
  <div class="listingblock pipeline-script"
        style="display: none">
    <div class="title">Jenkinsfile (Scripted Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">node {
    checkout scm

    <span style="color:#0a8;font-weight:bold">String</span> jdktool = tool <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jdk8</span><span style="color:#710">&quot;</span></span>, <span style="color:#606">type</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">hudson.model.JDK</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">def</span> mvnHome = tool <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mvn</span><span style="color:#710">'</span></span>

    <span style="color:#777">/* Set JAVA_HOME, and special PATH variables. */</span>
    <span style="color:#0a8;font-weight:bold">List</span> javaEnv = [
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">PATH+MVN=</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>jdktool<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">/bin:</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>mvnHome<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">/bin</span><span style="color:#710">&quot;</span></span>,
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">M2_HOME=</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>mvnHome<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>,
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">JAVA_HOME=</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>jdktool<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
    ]

    withEnv(javaEnv) {
    stage (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Initialize</span><span style="color:#710">'</span></span>) {
        sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'''</span><span style="color:#D20">
            echo &quot;PATH = ${PATH}&quot;
            echo &quot;M2_HOME = ${M2_HOME}&quot;
        </span><span style="color:#710">'''</span></span>
    }
    stage (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Build</span><span style="color:#710">'</span></span>) {
        <span style="color:#080;font-weight:bold">try</span> {
            sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mvn -Dmaven.test.failure.ignore=true install</span><span style="color:#710">'</span></span>
        } <span style="color:#080;font-weight:bold">catch</span> (e) {
            currentBuild.result = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">FAILURE</span><span style="color:#710">'</span></span>
        }
    }
    stage (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Post</span><span style="color:#710">'</span></span>) {
        <span style="color:#080;font-weight:bold">if</span> (currentBuild.result == <span style="color:#069">null</span> || currentBuild.result == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">SUCCESS</span><span style="color:#710">'</span></span>) {
            junit <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">target/surefire-reports/**/*.xml</span><span style="color:#710">'</span></span>  <span style="color:#777"><i class="conum" data-value="2"></i><b>(2)</b></span>
        }
    }
}</code></pre>
</div></div></div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Call <code>mvn</code>, the version configured by the <code>tools</code> section will be first on the path.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If the maven build succeeded, archive the JUnit test reports for display in the Jenkins web UI.
We&#8217;ll discuss the
<a href="/doc/book/pipeline/syntax/#post"><code>post</code> section</a> in detail in the next blog post.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are familiar with Scripted Pipeline, you can toggle the above
Declarative code sample to show the Scripted equivalent.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Below is the console output for this last revision:</p>
</div>
<div class="listingblock">
<div class="title">Console Output</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code>{ ... truncated lines ... }
+ mvn install
[INFO] Scanning for projects...
[WARNING] The POM for org.jenkins-ci.tools:maven-hpi-plugin:jar:1.119 is missing, no dependency information available
[WARNING] Failed to build parent project for org.jenkins-ci.plugins:junit:hpi:1.20-SNAPSHOT
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building JUnit Plugin 1.20-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO]
[INFO] --- maven-hpi-plugin:1.119:validate (default-validate) @ junit ---
[INFO]
[INFO] --- maven-enforcer-plugin:1.3.1:display-info (display-info) @ junit ---
[INFO] Maven Version: 3.3.9
[INFO] JDK Version: 1.8.0_92 normalized as: 1.8.0-92
[INFO] OS Info: Arch: x86_64 Family: mac Name: mac os x Version: 10.12.3
[INFO]
{ ... }
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 03:25 min
[INFO] Finished at: 2017-02-06T22:43:41-08:00
[INFO] Final Memory: 84M/1265M
[INFO] ------------------------------------------------------------------------</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion"><a class="anchor" href="#conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The new Declarative syntax is a significant step forward for Jenkins Pipeline.
It trades some verbosity and constraints for much greater clarity and
maintainability.  In the coming weeks, I&#8217;ll be adding new blog posts
demonstrating various features of the Declarative syntax along with some recent
Jenkins Pipeline improvements.</p>
</div>
<div class="sect2">
<h3 id="links"><a class="anchor" href="#links"></a>Links</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://plugins.jenkins.io/pipeline-model-definition">Declarative Pipeline</a></p>
</li>
<li>
<p><a href="/doc/book/pipeline/syntax/#declarative-pipeline">Declarative Pipeline Syntax Reference</a></p>
</li>
<li>
<p><a href="https://plugins.jenkins.io/junit">Jenkins JUnit plugin</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<!-- starting partial author.html.haml -->
<div id="about-the-author">
<b class="author about-header">
About the Author
</b>
<table class="author box">
<tr>
<td>
<!-- starting partial avatar.html.haml -->
<img alt="Liam Newman" class="author logo" src="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/images/avatars/lnewman.jpeg">

<!-- ending partial avatar.html.haml -->
</td>
<td>
<b class="author name">
<a href="/blog/authors/lnewman">
Liam Newman
</a>
</b>
<p>
<div class="paragraph">
<p>Liam started his software career as a tester, which might explain why he&#8217;s such a fan of CI/CD and Pipeline as Code.
He has spent the majority of his software engineering career implementing Continuous Integration systems at companies big and small.
He is a Jenkins project contributor and an expert in Jenkins Pipeline, both Scripted and Declarative.
Liam currently works as a Jenkins Evangelist at <a href="https://cloudbees.com">CloudBees</a>.
When not at work, he enjoys testing gravity by doing Aikido.</p>
</div>
</p>
<!-- starting partial social-media-buttons.html.haml -->
<ul class="author social-media-buttons">
<li class="author">
<a href="https://github.com/bitwiseman" target="_blank">
GitHub
</a>
</li>
<li class="author">
<a href="https://twitter.com/bitwiseman" target="_blank">
Twitter
</a>
</li>
</ul>

<!-- ending partial social-media-buttons.html.haml -->
</td>
</tr>
</table>
</div>

<!-- ending partial author.html.haml -->
</div>
</div>
</div>


<script src="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/assets/bower/anchor-js/anchor.min.js"></script>
<script src="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/assets/bower/tether/js/tether.min.js"></script>
<script src="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<footer id="footer">
<div class="container">
<div class="row">
<div class="col-md-4">
<p class="box">
<a href="https://github.com/jenkins-infra/jenkins.io/edit/master/content//blog/2017/02/2017-02-07-declarative-maven-project.adoc" title="Edit /blog/2017/02/2017-02-07-declarative-maven-project.adoc on GitHub">Improve this page</a>
|
<a href="https://github.com/jenkins-infra/jenkins.io/commits/master/content//blog/2017/02/2017-02-07-declarative-maven-project.adoc" title="View /blog/2017/02/2017-02-07-declarative-maven-project.adoc history on GitHub">Page history</a>
</p>
<div class="license-box">
<div id="creativecommons">
<a href="https://creativecommons.org/licenses/by-sa/4.0/">
<p>
<img alt="Creative Commons Attribution-ShareAlike license" src="https://licensebuttons.net/l/by-sa/4.0/88x31.png">
</p>
</a>
<p>
The content driving this site is licensed under the Creative
Commons Attribution-ShareAlike 4.0 license.
</p>
</div>
</div>
</div>
<div class="links col-md-8">
<div class="container">
<div class="row">
<div class="area col-md-3">
<div class="div-mar">
<h5>Resources</h5>
<ul class="resources">
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/events">
Events
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc">
Documentation
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/node">
Blog
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Solutions</h5>
<ul>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/android">
Android
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/c">
C/C++
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/docker">
Docker
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/embedded">
Embedded
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/github">
GitHub
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/java">
Java
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/php">
PHP
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/pipeline">
Continuous Delivery
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/python">
Python
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/ruby">
Ruby
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Project</h5>
<ul class="project">
<li>
<a href="https://issues.jenkins-ci.org">
Issue tracker
</a>
</li>
<li>
<a href="https://wiki.jenkins.io">
Wiki
</a>
</li>
<li>
<a href="https://github.com/jenkinsci">
GitHub
</a>
</li>
<li>
<a href="https://ci.jenkins.io">
Jenkins on Jenkins
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Community</h5>
<ul class="community">
<li>
<a href="https://groups.google.com/forum/#!forum/jenkinsci-users">
Users mailing list
</a>
</li>
<li>
<a href="https://groups.google.com/forum/#!forum/jenkinsci-dev">
Developers mailing list
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs">
Special Interest Groups
</a>
</li>
<li>
<a href="https://twitter.com/jenkinsci">
Twitter
</a>
</li>
<li>
<a href="https://reddit.com/r/jenkinsci">
Reddit
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/merchandise">
Merchandise
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/awards">
Awards
</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  !function(d,s,id) {
    var js, fjs=d.getElementsByTagName(s)[0];
    if (!d.getElementById(id)) {
      js = d.createElement(s);
      js.id=id;
      js.src="//platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js,fjs);
    }
  }(document,"script","twitter-wjs");
  
  $(function(){
    var $body = $(document.body);
    $(".nav-link.dropdown-toggle").on("mousedown", function(){
      $body.addClass("no-outline");
    })
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
</body>
</html>
