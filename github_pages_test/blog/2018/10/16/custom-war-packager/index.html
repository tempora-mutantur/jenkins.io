<!DOCTYPE html>
<html lang="en">
<head>
<title>
Build your own Jenkins! Introducing Custom WAR/Docker Packager
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="description">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sites/default/files/jenkins_favicon.ico" rel="shortcut icon" type="image/x-icon">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/img/favicon.ico" rel="icon" sizes="32x32" type="img/png">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/img/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/img/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/img/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/img/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/img/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152">
<meta content="Build your own Jenkins! Introducing Custom WAR/Docker Packager" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="Build your own Jenkins! Introducing Custom WAR/Docker Packager" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/images/logo-title-opengraph.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="Build your own Jenkins! Introducing Custom WAR/Docker Packager" property="og:title">
<meta content="article" property="og:type">
<meta content="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/blog/2018/10/16/custom-war-packager/index.html" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="og:description">
<meta content="Build your own Jenkins! Introducing Custom WAR/Docker Packager" property="og:site_name">
<meta content="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/images/logo-title-opengraph.png" name="og:image">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/assets/bower/tether/css/tether.min.css" media="screen" rel="stylesheet">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/css/font-icons.css" media="screen" rel="stylesheet">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/css/jenkins.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/assets/bower/ionicons/css/ionicons.min.css" media="screen" rel="stylesheet">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/css/footer.css" media="screen" rel="stylesheet">
<link href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/css/font-awesome.min.css" media="screen" rel="stylesheet">
</head>
<body>
<script src="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<nav class="navbar navbar-expand-md navbar-dark top bg-dark fixed-top" id="ji-toolbar">
<a class="navbar-brand" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test">
Jenkins
</a>
<button class="navbar-toggler" data-target="#CollapsingNavbar" data-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="CollapsingNavbar">
<ul class="nav navbar-nav ml-auto">
<li class="nav-item">
<a class="nav-link" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/node">
Blog
</a>
</li>
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
Documentation
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc">
Use Jenkins
</a>
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc/developer">
Extend Jenkins
</a>
<span class="dropdown-item">
<strong>
Use-cases
</strong>
</span>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/android">
&nbsp;-&nbsp;Android
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/c">
&nbsp;-&nbsp;C/C++
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/docker">
&nbsp;-&nbsp;Docker
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/embedded">
&nbsp;-&nbsp;Embedded
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/github">
&nbsp;-&nbsp;GitHub
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/java">
&nbsp;-&nbsp;Java
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/php">
&nbsp;-&nbsp;PHP
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/pipeline">
&nbsp;-&nbsp;Continuous Delivery
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/python">
&nbsp;-&nbsp;Python
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/ruby">
&nbsp;-&nbsp;Ruby
</a>
</div>
</li>
<li class="nav-item">
<a class="nav-link" href="https://plugins.jenkins.io/">
Plugins
</a>
</li>
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
Community
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/participate">
Overview
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/chat" title="Chat with the rest of the Jenkins community on IRC">
Chat
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/jam">
Meet
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/events">
Events
</a>
<a class="dropdown-item feature" href="https://issues.jenkins-ci.org/">
Issue Tracker
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/mailing-lists" title="Browse Jenkins mailing list archives and/or subscribe to lists">
Mailing Lists
</a>
<a class="dropdown-item feature" href="https://wiki.jenkins.io/">
Wiki
</a>
<a class="dropdown-item feature" href="https://accounts.jenkins.io/" title="Create/manage your account for accessing wiki, issue tracker, etc">
Account Management
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/">
<strong>
Special Interest Groups
</strong>
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/advocacy-and-outreach/">
&nbsp;-&nbsp;Advocacy and Outreach
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/chinese-localization/">
&nbsp;-&nbsp;Chinese Localization
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/cloud-native/">
&nbsp;-&nbsp;Cloud Native
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/docs/">
&nbsp;-&nbsp;Documentation
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/gsoc/">
&nbsp;-&nbsp;Google Summer of Code
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/hw-and-eda/">
&nbsp;-&nbsp;Hardware and EDA
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/pipeline-authoring/">
&nbsp;-&nbsp;Pipeline Authoring
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs/platform/">
&nbsp;-&nbsp;Platform
</a>
</div>
</li>
<li class="dropdown nav-item">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
Subprojects
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/">
Overview
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/blueocean/">
Blue Ocean
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/evergreen/">
Evergreen
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/gsoc/">
Google Summer of Code in Jenkins
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/infrastructure/">
Infrastructure
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/jam/">
Jenkins Area Meetups
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/jcasc/">
Jenkins Configuration as Code
</a>
<a class="dropdown-item feature" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/projects/remoting/">
Jenkins Remoting
</a>
</div>
</li>
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
About
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/security">
Security
</a>
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/press">
Press
</a>
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/awards">
Awards
</a>
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/project/conduct">
Conduct
</a>
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/artwork">
Artwork
</a>
</div>
</li>
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
English
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/zh">
中文 Chinese
</a>
</div>
</li>
<li class="nav-item">
<a class="nav-link btn btn-outline-secondary" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/download">
Download
</a>
</li>
</ul>
</div>
</nav>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<script>
  $(function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('#content h' + i);
    }
  })
</script>
<div class="container blog-post">
<div class="row body">
<div class="col-md-11 col-md-offset-1 main-content" id="content">
<div id="content-top">
<h1>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/blog/2018/10/16/custom-war-packager/" title="Build your own Jenkins! Introducing Custom WAR/Docker Packager">
Build your own Jenkins! Introducing Custom WAR/Docker Packager
</a>
</h1>
<div style="float: right; clear: all;">
<a class="twitter-share-button" data-lang="en" href="https://twitter.com/share">
Tweet
</a>
</div>
<div class="post-attrs">
<span class="submitted">
Published on
2018-10-16
by
<a href="/blog/authors/oleg_nenashev">Oleg Nenashev</a>
</span>
<ul class="list-inline tags">
<li>
<a class="tag-link" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/node/tags/tools">
tools
</a>
</li>
<li>
<a class="tag-link" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/node/tags/docker">
docker
</a>
</li>
<li>
<a class="tag-link" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/node/tags/jenkins-x">
jenkins-x
</a>
</li>
<li>
<a class="tag-link" href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/node/tags/cloud-native">
cloud-native
</a>
</li>
</ul>
</div>
</div>
<div class="paragraph">
<p>I would like to introduce <a href="https://github.com/jenkinsci/custom-war-packager">Custom WAR Packager</a> -
a new tool for Jenkins administrators and developers.
This tool allows packaging custom Jenkins distributions as WAR files,
<a href="https://github.com/jenkinsci/docker">Docker images</a>
and <a href="https://github.com/jenkinsci/jenkinsfile-runner">Jenkinsfile Runner</a> bundles.
This tool allows packaging Jenkins, plugins, and configurations in a ready-to-fly distribution.
Custom WAR packager is a part of the Ephemeral Jenkins master toolchain
which we presented in our <a href="/blog/2018/09/12/speaker-blog-a-cloud-native-jenkins/">A Cloud Native Jenkins</a> blogpost.
This toolchain is already used in <a href="https://jenkins-x.io">Jenkins X</a> to package <a href="https://github.com/jenkins-x/jenkins-x-serverless">serverless images</a>.</p>
</div>
<div class="paragraph">
<p>In this blogpost I will show some common use-cases for Custom WAR Packager.</p>
</div>
<div class="sect1">
<h2 id="history"><a class="anchor" href="#history"></a>History</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As with Jenkins itself, Custom WAR Packager started as a small development tool.
For a long time it was a problem to run integration testing in Jenkins.
We have 3 main frameworks for it:
    <a href="https://github.com/jenkinsci/jenkins-test-harness">Jenkins Test Harness</a>,
    <a href="https://github.com/jenkinsci/acceptance-test-harness">Acceptance Test Harness</a>,
    and <a href="https://github.com/jenkinsci/plugin-compat-tester">Plugin Compatibility Tester</a>.
All these frameworks require a Jenkins WAR file to be passed to them to run tests.
What if you want to run Jenkins tests in a custom environment like AWS?
Or what if you want to reuse existing Jenkins Pipeline tests and to run them against
<a href="/sigs/cloud-native/pluggable-storage/">Pluggable Storage</a> to ensure there are no regressions?</p>
</div>
<div class="paragraph">
<p>And it was not just an idle question.
There were major activities happening in the Jenkins project: Cloud-Native Jenkins, Jenkins Evergreen, and Jenkins X.
All these activities required a lot of integration testing  to enable Continuous Delivery flows.
In order to do this in existing test frameworks, we needed to package a self-configuring WAR file so that it would be possible to run integration tests in existing frameworks.
That is why Custom WAR Packager was created in April 2018.
Later it got support for packaging Docker images,
and in September 2018 it also got support for Jenkinsfile Runner
which was created by <a href="https://github.com/kohsuke/">Kohsuke Kawaguchi</a>
and then improved by <a href="https://github.com/ndeloof">Nicolas de Loof</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="whats-inside"><a class="anchor" href="#whats-inside"></a>What&#8217;s inside?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Custom WAR packager is a tool which is available as CLI Executable, Maven Plugin, or Docker package.
This tool takes input definitions and packages them as requested by the user.
Everything is managed by a YAML configuration file:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/post-images/2018-10-16-cwp/cwp_flow.png" alt="Custom WAR Packager build flow">
</div>
</div>
<div class="paragraph">
<p>The tool supports various types of inputs.
The list of plugins can be passed via YAML itself, <code>pom.xml</code>, or a BOM file from <a href="https://github.com/jenkinsci/jep/blob/master/jep/309/README.adoc">JEP-309</a>.
Custom WAR Packager supports not only released versions,
but also builds deployed to the <a href="/blog/2018/05/15/incremental-deployment/">Incremental repository</a> (CD flow for Jenkins core and plugins - <a href="https://github.com/jenkinsci/jep/blob/master/jep/305/README.adoc">JEP-305</a>) and
even direct builds by Git or directory path specifications.
It allows building packages from any source, without waiting for official releases.
The builds are also pretty fast, because the plugin does caching in the local Maven repository by using commit IDs.</p>
</div>
<div class="paragraph">
<p>Custom WAR packager also supports the following self-configuration options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>YAML files for <a href="https://github.com/jenkinsci/configuration-as-code-plugin">Jenkins Configuration as Code</a></p>
</li>
<li>
<p><a href="https://wiki.jenkins.io/display/JENKINS/Groovy+Hook+Script">Groovy Hooks</a> (e.g. init hooks for pre-configuration)</p>
</li>
<li>
<p>System properties</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="war-packaging"><a class="anchor" href="#war-packaging"></a>WAR Packaging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>WAR packaging happens by default every time the repo is built.
Generally Custom WAR Packager repackages all inputs into a single WAR file by following conventions defined in the Jenkins core and the JCasC plugin.</p>
</div>
<div class="paragraph">
<p>Sample configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span style="color:#606">bundle</span>:
  <span style="color:#606">groupId</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">io.jenkins.tools.war-packager.demo</span><span style="color:#710">&quot;</span></span>
  <span style="color:#606">artifactId</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">blogpost-demo</span><span style="color:#710">&quot;</span></span>
  <span style="color:#606">vendor</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Jenkins project</span><span style="color:#710">&quot;</span></span>
  <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Just a demo for the blogpost</span><span style="color:#710">&quot;</span></span>
<span style="color:#606">war</span>:
  <span style="color:#606">groupId</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.jenkins-ci.main</span><span style="color:#710">&quot;</span></span>
  <span style="color:#606">artifactId</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jenkins-war</span><span style="color:#710">&quot;</span></span>
  <span style="color:#606">source</span>:
    <span style="color:#606">version</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">2.138.2</span></span>
<span style="color:#606">plugins</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">groupId: &quot;io.jenkins&quot;</span></span>
    <span style="color:#606">artifactId</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">configuration-as-code</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">source</span>:
      <span style="color:#777"># Common release</span>
      <span style="color:#606">version</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1.0-rc2</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">groupId: &quot;io.jenkins&quot;</span></span>
    <span style="color:#606">artifactId</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">artifact-manager-s3</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">source</span>:
      <span style="color:#777"># Incrementals</span>
      <span style="color:#606">version</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1.2-rc259.c9d60bf2f88c</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">groupId: &quot;org.jenkins-ci.plugins.workflow&quot;</span></span>
    <span style="color:#606">artifactId</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">workflow-job</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">source</span>:
      <span style="color:#777"># Git</span>
      <span style="color:#606">git</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">https://github.com/jglick/workflow-job-plugin.git</span></span>
      <span style="color:#606">commit</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">18d78f305a4526af9cdf3a7b68eb9caf97c7cfbc</span></span>
  <span style="color:#777"># etc.</span>
<span style="color:#606">systemProperties</span>:
    <span style="color:#606">jenkins.model.Jenkins.slaveAgentPort</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">9000</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">jenkins.model.Jenkins.slaveAgentPortEnforce</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">true</span><span style="color:#710">&quot;</span></span>
<span style="color:#606">groovyHooks</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">type: &quot;init&quot;</span></span>
    <span style="color:#606">id</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">initScripts</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">source</span>:
      <span style="color:#606">dir</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">src/main/groovy</span></span>
<span style="color:#606">casc</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">id: &quot;jcasc&quot;</span></span>
    <span style="color:#606">source</span>:
      <span style="color:#606">dir</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">casc.yml</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="docker-packaging"><a class="anchor" href="#docker-packaging"></a>Docker packaging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to do the Docker packaging, Custom WAR Packager uses the official
<a href="https://hub.docker.com/r/jenkins/jenkins/">jenkins/jenkins</a>
Docker images or other images using the same format.
During the build the WAR file just gets replaced by the one built by the tool.
It means that <strong>ALL</strong> image features are available for such custom builds: <code>plugins.txt</code>, Java options, Groovy hooks, etc., etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span style="color:#777">## ...</span>
<span style="color:#777">## WAR configuration from above</span>
<span style="color:#777">## ...</span>

<span style="color:#606">buildSettings</span>:
  <span style="color:#606">docker</span>:
    <span style="color:#606">build</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
    <span style="color:#777"># Base image</span>
    <span style="color:#606">base</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jenkins/jenkins:2.138.2</span><span style="color:#710">&quot;</span></span>
    <span style="color:#777"># Tag to set for the produced image</span>
    <span style="color:#606">tag</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jenkins/custom-war-packager-casc-demo</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, <a href="https://github.com/jenkinsci/custom-war-packager/tree/master/demo/external-logging-elasticsearch">this demo</a>
shows packaging of a Docker image with External Build Logging to Elasticsearch.
Although the implementations have been improved as a part of <a href="https://github.com/jenkinsci/jep/blob/master/jep/207/README.adoc">JEP-207</a> and <a href="https://github.com/jenkinsci/jep/blob/master/jep/210/README.adoc">JEP-210</a>,
you can check out this demo to see how the Docker image does self-configuration, connects to a Elasicsearch, and then starts externally storing logs without changes in build log UIs.
A Docker Compose file for running the entire cluster is included.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jenkinsfile-runner-packaging"><a class="anchor" href="#jenkinsfile-runner-packaging"></a>Jenkinsfile Runner packaging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is probably the most tricky mode of Jenkinsfile Runner.
In March a new <a href="https://github.com/jenkinsci/jenkinsfile-runner">Jenkinsfile Runner</a> project
<a href="https://groups.google.com/d/msg/jenkinsci-dev/gjz3CDhi-kk/1mwi_oa0AQAJ">was announced</a> in the developer mailing list.
The main idea is to support running Jenkins Pipeline in a single-shot master mode when the instance just executes a single run and prints outputs to the console.
Jenkinsfile Runner runs as CLI or as a Docker image.
Custom WAR Packager is able to produce both, though only Docker run mode is recommended.
With Jenkinsfile Runner you can run Pipelines simply as&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">docker run --rm -v $PWD/Jenkinsfile:/workspace/Jenkinsfile acmeorg/jenkinsfile-runner</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we started working on Ephemeral (aka "single-shot") masters in the Cloud Native SIG,
there was an idea to use Custom WAR Packager and other existing tools (Jenkinsfile Runner, Jenkins Configuration as Code, etc.) to implement it.
It would be possible to just replace Jenkins core JAR and add plugins to Jenkinsfile Runner, but it is not enough.
To be efficient, Jenkinsfile Runner images should start up <strong>FAST</strong>, really fast.
In the build flow implementation we used some experimental options available in Jenkins and Jenkinsfile Runner, including classloader precaching, plugin unarchiving, etc, etc.
With such patches Jenkins starts up in few seconds with configuration-as-code and dozens of bundled plugins.</p>
</div>
<div class="paragraph">
<p>So, how to build custom Jenkinsfile Runner images?
Although there is no release so far, it is not something which can stop us as you see above.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span style="color:#777">##...</span>
<span style="color:#777">## WAR Configuration from above</span>
<span style="color:#777">##...</span>

<span style="color:#606">buildSettings</span>:
  <span style="color:#606">jenkinsfileRunner</span>:
    <span style="color:#606">source</span>:
      <span style="color:#606">groupId</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">io.jenkins</span><span style="color:#710">&quot;</span></span>
      <span style="color:#606">artifactId</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jenkinsfile-runner</span><span style="color:#710">&quot;</span></span>
      <span style="color:#606">build</span>:
        <span style="color:#606">noCache</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
      <span style="color:#606">source</span>:
        <span style="color:#606">git</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">https://github.com/jenkinsci/jenkinsfile-runner.git</span></span>
        <span style="color:#606">commit</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">8ff9b1e9a097e629c5fbffca9a3d69750097ecc4</span></span>
    <span style="color:#606">docker</span>:
      <span style="color:#606">base</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jenkins/jenkins:2.138.2</span><span style="color:#710">&quot;</span></span>
      <span style="color:#606">tag</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">onenashev/cwp-jenkinsfile-runner-demo</span><span style="color:#710">&quot;</span></span>
      <span style="color:#606">build</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can find a Demo of Jenkinsfile Runner packaging with Custom WAR Packager
<a href="https://github.com/jenkinsci/custom-war-packager/tree/master/demo/jenkinsfile-runner">here</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="more-info"><a class="anchor" href="#more-info"></a>More info</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are many other features which are not described in this blogpost.
For example, it is possible to alter Maven build settings or to add/replace libraries within the Jenkins core (e.g. Remoting).
Please see the <a href="https://github.com/jenkinsci/custom-war-packager/blob/master/README.md">Custom WAR Packager documentation</a> for more information.
There are a number of demos available in the repository.</p>
</div>
<div class="paragraph">
<p>If you are interested to contribute to the repository,
please create pull requests and CC <a href="https://github.com/oleg-nenashev/">@oleg-nenashev</a>
and <a href="https://github.com/raul-arabaolaza">Raul Arabaolaza</a> who is the second maintainer now working on Jenkins test automation flows.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="whats-next"><a class="anchor" href="#whats-next"></a>What&#8217;s next?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are still many improvements that could be made to the tool to make it more efficient:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add upper bounds checks for transitive plugin dependencies so that the conflicts are discovered during the build</p>
</li>
<li>
<p>Allow passing all kinds of system properties and Java options via configuration YAML</p>
</li>
<li>
<p>Improve Jenkinsfile Runner to improve performance</p>
</li>
<li>
<p>Integrate the tool into Jenkins Integration test flows
(see <a href="https://github.com/jenkins-infra/pipeline-library/blob/master/vars/essentialsTest.groovy">essentialsTest()</a>
 in the Jenkins Pipeline library)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Many other tasks could be implemented in Custom WAR Packager,
but even now it is available to all Jenkins users so that they can build their own Jenkins bundles with it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="want-to-know-more"><a class="anchor" href="#want-to-know-more"></a>Want to know more?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are going to <a href="https://www.cloudbees.com/devops-world/nice">DevOps World - Jenkins World in Nice</a> on Oct 22-25,
I will be presenting Custom WAR Packager at the Community Booth during the lunch demo sessions.
We will be also repeating our <a href="https://sched.co/FIox">A Cloud Native Jenkins</a> talk together with Carlos Sanchez where we will show how Ephemeral Jenkins works with Pluggable Storage.
Jenkins X team is also going to present their project using Custom WAR Packager.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Come meet Oleg and other Cloud Native SIG members at
<a href="https://www.cloudbees.com/devops-world/nice">DevOps World - Jenkins World</a> on October 22-25 in Nice.
register with the code <code>JWFOSS</code> for a 30% discount off your pass.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<!-- starting partial author.html.haml -->
<div id="about-the-author">
<b class="author about-header">
About the Author
</b>
<table class="author box">
<tr>
<td>
<!-- starting partial avatar.html.haml -->
<img alt="Oleg Nenashev" class="author logo" src="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/images/avatars/oleg_nenashev.png">

<!-- ending partial avatar.html.haml -->
</td>
<td>
<b class="author name">
<a href="/blog/authors/oleg_nenashev">
Oleg Nenashev
</a>
</b>
<p>
<div class="paragraph">
<p>R&amp;D and Automation engineer with Hardware/Embedded background.
He started using Hudson/Jenkins in 2008 and became an active contributor in 2012.
Oleg maintains Jenkins core,
<a href="/projects/remoting">Remoting</a> and several plugins.
He organizes events like <a href="/projects/jam/">Jenkins meetups</a>
and <a href="/projects/gsoc">GSoC</a> in the community.
Nowadays Oleg works at <a href="https://www.cloudbees.com/">CloudBees</a> on making Jenkins cloud-native.</p>
</div>
</p>
<!-- starting partial social-media-buttons.html.haml -->
<ul class="author social-media-buttons">
<li class="author">
<a href="https://github.com/oleg-nenashev" target="_blank">
GitHub
</a>
</li>
<li class="author">
<a href="https://twitter.com/oleg_nenashev" target="_blank">
Twitter
</a>
</li>
<li class="author">
<a href="https://oleg-nenashev.github.io/" target="_blank">
Blog
</a>
</li>
</ul>

<!-- ending partial social-media-buttons.html.haml -->
</td>
</tr>
</table>
</div>

<!-- ending partial author.html.haml -->
</div>
</div>
</div>


<script src="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/assets/bower/anchor-js/anchor.min.js"></script>
<script src="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/assets/bower/tether/js/tether.min.js"></script>
<script src="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<footer id="footer">
<div class="container">
<div class="row">
<div class="col-md-4">
<p class="box">
<a href="https://github.com/jenkins-infra/jenkins.io/edit/master/content//blog/2018/10/2018-10-16-custom-war-packager.adoc" title="Edit /blog/2018/10/2018-10-16-custom-war-packager.adoc on GitHub">Improve this page</a>
|
<a href="https://github.com/jenkins-infra/jenkins.io/commits/master/content//blog/2018/10/2018-10-16-custom-war-packager.adoc" title="View /blog/2018/10/2018-10-16-custom-war-packager.adoc history on GitHub">Page history</a>
</p>
<div class="license-box">
<div id="creativecommons">
<a href="https://creativecommons.org/licenses/by-sa/4.0/">
<p>
<img alt="Creative Commons Attribution-ShareAlike license" src="https://licensebuttons.net/l/by-sa/4.0/88x31.png">
</p>
</a>
<p>
The content driving this site is licensed under the Creative
Commons Attribution-ShareAlike 4.0 license.
</p>
</div>
</div>
</div>
<div class="links col-md-8">
<div class="container">
<div class="row">
<div class="area col-md-3">
<div class="div-mar">
<h5>Resources</h5>
<ul class="resources">
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/events">
Events
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/doc">
Documentation
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/node">
Blog
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Solutions</h5>
<ul>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/android">
Android
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/c">
C/C++
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/docker">
Docker
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/embedded">
Embedded
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/github">
GitHub
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/java">
Java
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/php">
PHP
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/pipeline">
Continuous Delivery
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/python">
Python
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/solutions/ruby">
Ruby
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Project</h5>
<ul class="project">
<li>
<a href="https://issues.jenkins-ci.org">
Issue tracker
</a>
</li>
<li>
<a href="https://wiki.jenkins.io">
Wiki
</a>
</li>
<li>
<a href="https://github.com/jenkinsci">
GitHub
</a>
</li>
<li>
<a href="https://ci.jenkins.io">
Jenkins on Jenkins
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Community</h5>
<ul class="community">
<li>
<a href="https://groups.google.com/forum/#!forum/jenkinsci-users">
Users mailing list
</a>
</li>
<li>
<a href="https://groups.google.com/forum/#!forum/jenkinsci-dev">
Developers mailing list
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/sigs">
Special Interest Groups
</a>
</li>
<li>
<a href="https://twitter.com/jenkinsci">
Twitter
</a>
</li>
<li>
<a href="https://reddit.com/r/jenkinsci">
Reddit
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/merchandise">
Merchandise
</a>
</li>
<li>
<a href="https://tempora-mutantur.github.io/jenkins.io/github_pages_test/awards">
Awards
</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  !function(d,s,id) {
    var js, fjs=d.getElementsByTagName(s)[0];
    if (!d.getElementById(id)) {
      js = d.createElement(s);
      js.id=id;
      js.src="//platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js,fjs);
    }
  }(document,"script","twitter-wjs");
  
  $(function(){
    var $body = $(document.body);
    $(".nav-link.dropdown-toggle").on("mousedown", function(){
      $body.addClass("no-outline");
    })
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
</body>
</html>
